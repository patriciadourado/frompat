{"componentChunkName":"component---src-templates-blog-post-js","path":"/jwt-login-flask/","result":{"data":{"site":{"siteMetadata":{"title":"from Pat"}},"markdownRemark":{"id":"255da0a7-a6fc-5e0a-ab22-bb963ade175e","excerpt":"This is a simple tutorial to help you build a simple JWT based login application and registration using the micro web framework Flask. Before running the Flask…","html":"<p>This is a simple tutorial to help you build a simple JWT based login application and registration using the micro web framework <strong>Flask</strong>.</p>\n<p>Before running the Flask API its necessary to install a bunch of packages as you can check listed here <a href=\"https://github.com/patriciadourado/jwtlogin-flask/blob/master/requirements.txt\">requirements.txt</a>.</p>\n<h2>Python Virtual Environment</h2>\n<p>To install the required modules I’ve used <code class=\"language-text\">Python virtualenv</code> to create a isolated Virtual Environment in Python so the project can have it’s own dependencies independently of other project’s dependencies. In resume: for not installing globally this modules. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/frompat/static/6aa6c0800b4ad89ae2775f88fa7d1da1/4a29e/python-virtualenv-project-structure.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAIDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB8q6GLpRhRUA//8QAGRAAAwEBAQAAAAAAAAAAAAAAAAECERIQ/9oACAEBAAEFAh+XvNldDZQ3p//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABYRAAMAAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPwEr/8QAHRAAAQMFAQAAAAAAAAAAAAAAAQAQIgIREiExI//aAAgBAQAGPwJcamNkI46Q8xxg3//EAB0QAAICAgMBAAAAAAAAAAAAAAERACExYRBBcYH/2gAIAQEAAT8hG38iFWFcZEBVEdx1Vo7gFgeIYrQqPmSahMvJ/9oADAMBAAIAAwAAABCj177/xAAWEQADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8QI//EABcRAQADAAAAAAAAAAAAAAAAAAEAEGH/2gAIAQIBAT8QFmr/AP/EABwQAQEAAgMBAQAAAAAAAAAAAAERACExUWFx4f/aAAgBAQABPxAi6R4xlCgBAj6465xpKqAn29/uNqk0Gj7wFgIk5e5BLogXgxo4BCth0YoO8AXcDP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Python virtualenv\"\n        title=\"Python virtualenv\"\n        src=\"/frompat/static/6aa6c0800b4ad89ae2775f88fa7d1da1/828fb/python-virtualenv-project-structure.jpg\"\n        srcset=\"/frompat/static/6aa6c0800b4ad89ae2775f88fa7d1da1/ff44c/python-virtualenv-project-structure.jpg 158w,\n/frompat/static/6aa6c0800b4ad89ae2775f88fa7d1da1/a6688/python-virtualenv-project-structure.jpg 315w,\n/frompat/static/6aa6c0800b4ad89ae2775f88fa7d1da1/828fb/python-virtualenv-project-structure.jpg 630w,\n/frompat/static/6aa6c0800b4ad89ae2775f88fa7d1da1/4a29e/python-virtualenv-project-structure.jpg 765w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4>Installation</h4>\n<p>To install <code class=\"language-text\">virtualenv</code> just run the following command on your project folder (here we use pip on windows):</p>\n<p><code class=\"language-text\">py -3 -m pip install --user virtualenv</code></p>\n<h4>Creating a Virtual Environment</h4>\n<p>To create a Virtual Environment name <strong>myproject</strong>:</p>\n<p><code class=\"language-text\">py -3 -m venv myproject</code></p>\n<p>You will see a new folder created called <strong>myproject</strong></p>\n<h4>Activation</h4>\n<p>To activate and use your new virtual environment, just run:</p>\n<p><code class=\"language-text\">myproject\\Scripts\\activate</code></p>\n<p>Now you can start to install the modules and packages you want and run your project on the new environment. </p>\n<p>To install requeriments.txt just this command:</p>\n<p><code class=\"language-text\">pip install -r requirements.txt</code></p>\n<p>To deactivate <strong>myproject</strong> just run: <code class=\"language-text\">deactivate</code>.</p>\n<h2>PostegreSQL</h2>\n<p>Its also necessary to create a database and <strong>users</strong> table before anything. I’ve used <a href=\"https://www.postgresql.org/\">PostegreSQL</a> as database and pgAdmin 4 interface to create the DB and table.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 544px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/frompat/static/d1fb21650c74fb1f77da56915b6f8eca/b3e51/pgadmin4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByUlEQVQoz5WS3UuTYRiH99d0FEHiH9BBaOcdddJZoognokZfB0Gk4qQxnc0IY1kbhoFrbgsc1PxY+3g3x5xrzjCnZR+YbWvbu7b3fa+ed6JMScEbfs/NzfNwcT+/+zZomsZpcXgvstagk8KgH8U/BYKRGCvJVaRYnHA0zmIwQrGQrz9SVRVVQNRDIFSrVWS5glypUBH6K2r9nQCqWF6+oanDxPUBOxfbH9Fy8wktfeOYJ2d03H87KeZzSMEAocAS0UiYne0scrksgDWZriEbFzof0z3u5lLfUy7fmqBzbJY7o3Z2dvN8+S3zLVdG2tzjXfon23sl3ouc+prj0/cC8ewvMiIrqqZ3qDFqd9HcNcbVBw5abz/jyl0bvVYnLt881oUt+t0pjG/XuDezyn1XCpNvnYfujwx417D6Nxj0pjHNrfMjL+97qPvX3D5Mj+U11/odnLthZmhyFo/Hi190kt0tMbH4mfnlNNJyAs+ChC8QIxRL8CGawB8SvseTlISndaD+9ymnlxeOV/SOTHG+w4LZNk0mk+GsYTi+AsbnTprajCRWkvVaaZjwwZSPTvyoDAe7VlOUOmBjcwt/IIxSq6E17KF2AuC4/gFD04A2ThY7OwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pgadmin4\"\n        title=\"pgadmin4\"\n        src=\"/frompat/static/d1fb21650c74fb1f77da56915b6f8eca/b3e51/pgadmin4.png\"\n        srcset=\"/frompat/static/d1fb21650c74fb1f77da56915b6f8eca/c26ae/pgadmin4.png 158w,\n/frompat/static/d1fb21650c74fb1f77da56915b6f8eca/6bdcf/pgadmin4.png 315w,\n/frompat/static/d1fb21650c74fb1f77da56915b6f8eca/b3e51/pgadmin4.png 544w\"\n        sizes=\"(max-width: 544px) 100vw, 544px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4>Create users table</h4>\n<p>The SQL for the created users table is the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">public</span><span class=\"token punctuation\">.</span>users\n<span class=\"token punctuation\">(</span>\n    id <span class=\"token keyword\">integer</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> nextval<span class=\"token punctuation\">(</span><span class=\"token string\">'users_id_seq'</span>::regclass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    username <span class=\"token keyword\">text</span> <span class=\"token keyword\">COLLATE</span> pg_catalog<span class=\"token punctuation\">.</span><span class=\"token string\">\"default\"</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    password <span class=\"token keyword\">text</span> <span class=\"token keyword\">COLLATE</span> pg_catalog<span class=\"token punctuation\">.</span><span class=\"token string\">\"default\"</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    roles <span class=\"token keyword\">text</span> <span class=\"token keyword\">COLLATE</span> pg_catalog<span class=\"token punctuation\">.</span><span class=\"token string\">\"default\"</span><span class=\"token punctuation\">,</span>\n    is_active <span class=\"token keyword\">boolean</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">CONSTRAINT</span> users_pkey <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">TABLESPACE</span> pg_default<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">public</span><span class=\"token punctuation\">.</span>users\n    OWNER <span class=\"token keyword\">to</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">insert</span> here your user_database<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>DB Model</h2>\n<p>A model that might be used using <strong>flask-praetorian</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    \n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'users'</span>\n\n    <span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>Column<span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    username <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>Column<span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">,</span> unique<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    password <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>Column<span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    roles <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>Column<span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">)</span>\n    is_active <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>Column<span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Boolean<span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> server_default<span class=\"token operator\">=</span><span class=\"token string\">'true'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token decorator annotation punctuation\">@property</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">rolenames</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>roles<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">except</span> Exception<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token decorator annotation punctuation\">@classmethod</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">lookup</span><span class=\"token punctuation\">(</span>cls<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> cls<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>one_or_none<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token decorator annotation punctuation\">@classmethod</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">identify</span><span class=\"token punctuation\">(</span>cls<span class=\"token punctuation\">,</span> <span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> cls<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token decorator annotation punctuation\">@property</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">identity</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">is_valid</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>is_active</code></pre></div>\n<h2>Initialize Flask App</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">app <span class=\"token operator\">=</span> flask<span class=\"token punctuation\">.</span>Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\napp<span class=\"token punctuation\">.</span>debug <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'SECRET_KEY'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'my secret key'</span>\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'JWT_ACCESS_LIFESPAN'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'hours'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">24</span><span class=\"token punctuation\">}</span>\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'JWT_REFRESH_LIFESPAN'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'days'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Initialize the flask-praetorian instance for the app</span>\nguard<span class=\"token punctuation\">.</span>init_app<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> User<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>SQLAlchemy</h2>\n<p>The <a href=\"https://www.sqlalchemy.org/\">SQLAlchemy</a> was used as the Python ORM for accessing data from the database and facilitate the communication between app and db converting function calls to SQL statements.</p>\n<p>Do not forget to change <strong><em>‘SQLALCHEMY<em>DATABASE</em>URI’</em></strong> to your own here:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Initialize a local database</span>\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'SQLALCHEMY_DATABASE_URI'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'postgresql://user_database:password@hostname:5432/database_name'</span>\ndb<span class=\"token punctuation\">.</span>init_app<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Initializes CORS so that the api_tool can talk to app</span>\ncors<span class=\"token punctuation\">.</span>init_app<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Endpoints</h2>\n<p>Some endpoints were defined to be consumed by the frontend application, they are:</p>\n<p><strong>1. /api/</strong></p>\n<p>The first endpoint is the confirmation our API is up running!</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"World\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span></code></pre></div>\n<p><strong>2. /api/login</strong></p>\n<p>The second endpoint receives the user credentials (by POST request) and authenticates/logs it with flask-praetorian ‘authenticate’ method issuing a user JWT access token and returning a 200 code with the token;</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/login'</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Logs a user in by parsing a POST request containing user credentials and\n    issuing a JWT token.\n    \"\"\"</span>\n    req <span class=\"token operator\">=</span> flask<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>get_json<span class=\"token punctuation\">(</span>force<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    username <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'username'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n    password <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n    user <span class=\"token operator\">=</span> guard<span class=\"token punctuation\">.</span>authenticate<span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span>\n    ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'access_token'</span><span class=\"token punctuation\">:</span> guard<span class=\"token punctuation\">.</span>encode_jwt_token<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> ret<span class=\"token punctuation\">,</span> <span class=\"token number\">200</span></code></pre></div>\n<p><strong>3. /api/refresh</strong></p>\n<p>The third endpoint refreshes (by POST request) an existing JWT creating a new one with a new access expiration, returning a 200 code with the new token;</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/refresh'</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Refreshes an existing JWT by creating a new one that is a copy of the old\n    except that it has a refreshed access expiration.\n    .. example::\n       $ curl http://localhost:5000/api/refresh -X GET \\\n         -H \"Authorization: Bearer &lt;your_token>\"\n    \"\"\"</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"refresh request\"</span><span class=\"token punctuation\">)</span>\n    old_token <span class=\"token operator\">=</span> Request<span class=\"token punctuation\">.</span>get_data<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    new_token <span class=\"token operator\">=</span> guard<span class=\"token punctuation\">.</span>refresh_jwt_token<span class=\"token punctuation\">(</span>old_token<span class=\"token punctuation\">)</span>\n    ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'access_token'</span><span class=\"token punctuation\">:</span> new_token<span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> ret<span class=\"token punctuation\">,</span> <span class=\"token number\">200</span></code></pre></div>\n<p><strong>4. /api/protected</strong></p>\n<p>The fourth endpoint is a protected endpoint which requires a header with a valid JWT using the <code class=\"language-text\">@flask_praetorian.auth_required</code> decorator. The endpoint returns a message with the current user username as a secret message;</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/protected'</span><span class=\"token punctuation\">)</span>\n<span class=\"token decorator annotation punctuation\">@flask_praetorian<span class=\"token punctuation\">.</span>auth_required</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">protected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    A protected endpoint. The auth_required decorator will require a header\n    containing a valid JWT\n    .. example::\n       $ curl http://localhost:5000/api/protected -X GET \\\n         -H \"Authorization: Bearer &lt;your_token>\"\n    \"\"\"</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'protected endpoint (allowed usr {})'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>flask_praetorian<span class=\"token punctuation\">.</span>current_user<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>5. /api/registration</strong></p>\n<p>The fifth endpoint is a simple user registration without requiring user email (for now), with the password hash method being invoked only to demonstrate insertion into database if its a new user;</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/registration'</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">registration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    \n    <span class=\"token triple-quoted-string string\">\"\"\"Register user without validation email, only for test\"\"\"</span>\n\n    req <span class=\"token operator\">=</span> flask<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>get_json<span class=\"token punctuation\">(</span>force<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    username <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'username'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n    password <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">with</span> app<span class=\"token punctuation\">.</span>app_context<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        db<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n            db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">(</span>\n                username<span class=\"token operator\">=</span>username<span class=\"token punctuation\">,</span>\n                password<span class=\"token operator\">=</span>guard<span class=\"token punctuation\">.</span>hash_password<span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                roles<span class=\"token operator\">=</span><span class=\"token string\">'user'</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n    user <span class=\"token operator\">=</span> guard<span class=\"token punctuation\">.</span>authenticate<span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span>\n    ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'access_token'</span><span class=\"token punctuation\">:</span> guard<span class=\"token punctuation\">.</span>encode_jwt_token<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> ret<span class=\"token punctuation\">,</span><span class=\"token number\">200</span></code></pre></div>\n<h2>Run Flask App</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Run</span>\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    app<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Running Locally</h2>\n<p>To run your application locally you can use the following command:</p>\n<p><code class=\"language-text\">flask run</code></p>\n<h2>Deploying Application</h2>\n<p>This application was deployed on <strong>Heroku.</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/frompat/static/37aa2307f5601021f0560a681bf73563/d61c2/heroku.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.405063291139236%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA4UlEQVQoz5WSTQsBURSG70xMGB9FkeRPGGGHmVJSUhYsWFrJ2sbGUlayMHtLf9JzzTGGTHLq6b3ndD7mnjtKYa66aDJge8q35axjJhifSo4ZiRkSU6ERSMOC4AAdwRJS6k8Lm3oU4+hGe+hDE7+KTqCrh0EPVtCBKQxluAMu+aloZ1sKZ7CVhDp6c5W/Q6+wCfyHHuEEB1jDmXwrcmU/S3AMNfnSOeQgqfdJrIIW9I5lv2VqLDQPRSjJTcMd6sIWhQ40OLch8d/+Xs1ik+QFo6pi/PdezyQveP7n7/Fz4De7AytbajWFn6a0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"heroku\"\n        title=\"heroku\"\n        src=\"/frompat/static/37aa2307f5601021f0560a681bf73563/f058b/heroku.png\"\n        srcset=\"/frompat/static/37aa2307f5601021f0560a681bf73563/c26ae/heroku.png 158w,\n/frompat/static/37aa2307f5601021f0560a681bf73563/6bdcf/heroku.png 315w,\n/frompat/static/37aa2307f5601021f0560a681bf73563/f058b/heroku.png 630w,\n/frompat/static/37aa2307f5601021f0560a681bf73563/40601/heroku.png 945w,\n/frompat/static/37aa2307f5601021f0560a681bf73563/78612/heroku.png 1260w,\n/frompat/static/37aa2307f5601021f0560a681bf73563/d61c2/heroku.png 1800w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The deployment is not described in this article. You can check the app up and running <a href=\"https://jwtlogin-app.herokuapp.com/api/\">here</a>.</p>\n<h2>Flask-praetorian</h2>\n<p>To let the things easier Flask-praetorian was used to handle the hard logic by itself. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/frompat/static/c07af707e6b56666a970e813169e4da0/df009/flask-praetorian.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.62025316455696%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAAiklEQVQY06XPQQrCMBCF4SRKBa3gzhZKraZVEBRFJSCEbpNFSO5/Gn+1PUEHPl54kIER4j8L5EqpJZmJibPCWkrZkDetdR1CqJxzmxhjaa2t6O84o8AeHb79CwdssUMzLs1YeCTfxpgipVR671sWP/u+v9K3uAwfxqzxwGl4d4PfzDDn5JxUU879ALt7DU/+U9TwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flask-praetorian\"\n        title=\"flask-praetorian\"\n        src=\"/frompat/static/c07af707e6b56666a970e813169e4da0/f058b/flask-praetorian.png\"\n        srcset=\"/frompat/static/c07af707e6b56666a970e813169e4da0/c26ae/flask-praetorian.png 158w,\n/frompat/static/c07af707e6b56666a970e813169e4da0/6bdcf/flask-praetorian.png 315w,\n/frompat/static/c07af707e6b56666a970e813169e4da0/f058b/flask-praetorian.png 630w,\n/frompat/static/c07af707e6b56666a970e813169e4da0/40601/flask-praetorian.png 945w,\n/frompat/static/c07af707e6b56666a970e813169e4da0/78612/flask-praetorian.png 1260w,\n/frompat/static/c07af707e6b56666a970e813169e4da0/df009/flask-praetorian.png 2832w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Among the advantages of using Flask-praetorian in this API (where the most important is undoubtedly allowing to use JWT token for authentication) are:</p>\n<ul>\n<li>Hash passwords for storing in database;</li>\n<li>Verify plaintext passwords against the hashed, stored versions;</li>\n<li>Generate authorization tokens upon verification of passwords;</li>\n<li>Check requests to secured endpoints for authorized tokens;</li>\n<li>Supply expiration of tokens and mechanisms for refreshing them;</li>\n<li>Ensure that the users associated with tokens have necessary roles for access;</li>\n</ul>\n<p>You can check Flask-praetorian documentation here: <a href=\"https://flask-praetorian.readthedocs.io/en/latest/index.html#table-of-contents\">Flask-praetorian</a></p>\n<h2>Frontend Application</h2>\n<p>For now the ReactJS application (check the repository <a href=\"https://github.com/patriciadourado/jwtlogin-reactjs\">here</a>) that consumes this Flask API provides three different pages:</p>\n<ol>\n<li>The <code class=\"language-text\">Home page</code> with the login button (if the user isn’t logged) and with the secret button and the logout button (assuming the user is logged);</li>\n<li>The <code class=\"language-text\">Login Page</code> where the user can log-in;</li>\n<li>The <code class=\"language-text\">Protected page</code> with a content message that only the logged user can view;</li>\n</ol>\n<p><strong>Note:</strong> You can check the whole jwtlogin flask application code in this** <a href=\"https://github.com/patriciadourado/jwtlogin-flask\">github repository</a>** and the deployed with ReactJS part on its description link;</p>\n<p>Link inspirations:</p>\n<ul>\n<li><a href=\"http://yasoob.me/posts/how-to-setup-and-deploy-jwt-auth-using-react-and-flask/\">Setting up &#x26; Deploying JWT based auth using Flask &#x26; React</a></li>\n<li><a href=\"https://realpython.com/flask-by-example-part-2-postgres-sqlalchemy-and-alembic/\">Flask by Example – Setting up Postgres, SQLAlchemy, and Alembic</a></li>\n<li><a href=\"https://ckraczkowsky.medium.com/building-a-secure-admin-interface-with-flask-admin-and-flask-security-13ae81faa05\">Building a secure admin interface with Flask-Admin and Flask-Security</a></li>\n<li><a href=\"https://medium.com/analytics-vidhya/heroku-deploy-your-flask-app-with-a-database-online-d19274a7a749\">Heroku: Deploy your Flask App with a Database Online</a></li>\n<li><a href=\"https://medium.com/@vapurrmaid/getting-started-with-heroku-postgres-and-pgadmin-run-on-part-2-90d9499ed8fb\">Getting Started with Heroku, Postgres and PgAdmin — RUN__ON Part 2</a></li>\n</ul>","frontmatter":{"title":"JWT Login Flask","date":"May 29, 2021","description":"A Flask JWT based login authentication using flask-praetorian module to handle the hard part and SQLAlchemy as ORM with PostreSQL as database.","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAABJ0AAASdAHeZh94AAABGklEQVQoz5WSzU6DQBzEeTwTX8cYtdrooVFa8KaxnvQFvOpJL/ZmUlF6NKmffNTKLqzIwkodMZpIsrt0wuG/sL+ZzSzGTKmyLBVfDRlAX6fD84tSaS2Fp0G4sbB4dTlQ5BuK0w5Oz06Ojj84l/HS5Jzzu/H9+OGR80x8fksPCyGSJAmCkNL4zwsk3hdFoYHfK00mIaGUMQYjLDGkaYpBA2MTsKfnl7coyn+FWM45LBokM+b7Poki5MZJDMbzPEIIfDUwtma5SMUs+18Q8jXJ6AatDJ2bpdX1lfZmx+ztWHarvbW81rp2HBy+dl91GKW6o9F2z+rau3sH/f3+oWnZHbN767povNFV/YhUwsCqR2jhuST9PWuaA26oL6qdm/78nz2MAAAAAElFTkSuQmCC","aspectRatio":1.2820512820512822,"src":"/frompat/static/afb87f5954821086b2a2bb1089c1f191/2a4de/jwt-reactjs-flask.png","srcSet":"/frompat/static/afb87f5954821086b2a2bb1089c1f191/6d161/jwt-reactjs-flask.png 150w,\n/frompat/static/afb87f5954821086b2a2bb1089c1f191/630fb/jwt-reactjs-flask.png 300w,\n/frompat/static/afb87f5954821086b2a2bb1089c1f191/2a4de/jwt-reactjs-flask.png 600w,\n/frompat/static/afb87f5954821086b2a2bb1089c1f191/db955/jwt-reactjs-flask.png 900w,\n/frompat/static/afb87f5954821086b2a2bb1089c1f191/57b73/jwt-reactjs-flask.png 1123w","sizes":"(max-width: 600px) 100vw, 600px"}}}}},"previous":{"fields":{"slug":"/using-netlify-cms-to-manage-my-blog-posts/"},"frontmatter":{"title":"Using Netlify CMS to manage my blog posts"}},"next":{"fields":{"slug":"/developing-a-twitter-bot-with-python/"},"frontmatter":{"title":"Developing a Twitter bot with Python"}}},"pageContext":{"id":"255da0a7-a6fc-5e0a-ab22-bb963ade175e","previousPostId":"bcdbaaf4-4654-55bf-b732-2b889ead83de","nextPostId":"75821f1f-2ce4-5110-9a26-8ccd42fd34d5"}},"staticQueryHashes":["3991963069","916993862"]}