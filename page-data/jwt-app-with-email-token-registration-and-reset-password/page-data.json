{"componentChunkName":"component---src-templates-blog-post-js","path":"/jwt-app-with-email-token-registration-and-reset-password/","result":{"data":{"site":{"siteMetadata":{"title":"from Pat"}},"markdownRemark":{"id":"af3dc10a-d2c7-5158-b116-fe131ade96be","excerpt":"In this article we gonna describe the new features added to the Flask and ReactJS JWT application started and documented before here: JWT Login Flask. Flask…","html":"<p>In this article we gonna describe the new features added to the Flask and ReactJS JWT application started and documented before here: <a href=\"https://patriciadourado.com/frompat/jwt-login-flask/\">JWT Login Flask</a>.</p>\n<h2>Flask Mail</h2>\n<p>To start we are going to use the Flask Mail extension to send emails through Flask from our endpoint to the user registered email on the frontend ReactJS app.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 473px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/frompat/static/2cf3e51b72d4902e09dc707dc55d4f31/c7c3c/flaskmail.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.151898734177216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAApUlEQVQI152NOwqGMBCEvbmddQqLXEDs0ngKGx8xAV/YCOnUoBKMonF+vMG/xfAxO7vjOeee54EOw1AURVVVSZLEcbxtG8wsy8qyBBzHYa09z/O+b/A4jsYY71tIKYUQ0zRFUUQpZYwRQsIwDILA9/08z/u+55w3TYPvdV0D1nX1ruvCmzRNcdl1HVylFKJfqG1bNO/7js5lWbTW8zxDwaj8Nf89Lx6d1kIa2LhJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flaskmail\"\n        title=\"Flask-Mail\"\n        src=\"/frompat/static/2cf3e51b72d4902e09dc707dc55d4f31/c7c3c/flaskmail.png\"\n        srcset=\"/frompat/static/2cf3e51b72d4902e09dc707dc55d4f31/c26ae/flaskmail.png 158w,\n/frompat/static/2cf3e51b72d4902e09dc707dc55d4f31/6bdcf/flaskmail.png 315w,\n/frompat/static/2cf3e51b72d4902e09dc707dc55d4f31/c7c3c/flaskmail.png 473w\"\n        sizes=\"(max-width: 473px) 100vw, 473px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>The Flask-Mail extension provides a simple interface to set up SMTP with your Flask application and to send messages from your views and scripts.</p>\n</blockquote>\n<h3>Installation</h3>\n<p>Through pip we just need to run the following command to install Flask Mail on our Flask application:</p>\n<p><code class=\"language-text\">pip install Flask-Mail</code></p>\n<p>Just remembering we are using <strong>virtualenv</strong> to install our packages and modules;</p>\n<p>After installation we need to configure the Flask Mail on our app, like following:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">MAIL_SERVER <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>getenv<span class=\"token punctuation\">(</span><span class=\"token string\">'MAIL_SERVER'</span><span class=\"token punctuation\">)</span>\nMAIL_PORT  <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>getenv<span class=\"token punctuation\">(</span><span class=\"token string\">'MAIL_PORT'</span><span class=\"token punctuation\">)</span>\nMAIL_USERNAME  <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>getenv<span class=\"token punctuation\">(</span><span class=\"token string\">'MAIL_USERNAME'</span><span class=\"token punctuation\">)</span>\nMAIL_PASSWORD  <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>getenv<span class=\"token punctuation\">(</span><span class=\"token string\">'MAIL_PASSWORD'</span><span class=\"token punctuation\">)</span>\nSUBJECT <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>getenv<span class=\"token punctuation\">(</span><span class=\"token string\">'SUBJECT'</span><span class=\"token punctuation\">)</span>\nCONFIRMATION_URI <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>getenv<span class=\"token punctuation\">(</span><span class=\"token string\">'CONFIRMATION_URI'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>dotenv</h4>\n<p><em>Note: I am using dotenv as a file to not expose my credentials and secret information, that is why the <code class=\"language-text\">os.getenv</code> is necessary, to get the environment variables.</em></p>\n<p>To install <strong>dotenv</strong> just run:\n<code class=\"language-text\">pip install python-dotenv</code></p>\n<p>With Flask Mail extension you will need to import doenv and load your credentials from .env file like following:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> flask_mail <span class=\"token keyword\">import</span> Mail\n<span class=\"token keyword\">from</span> dotenv <span class=\"token keyword\">import</span> load_dotenv\n\n\nload_dotenv<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># take environment variables from .env.</span></code></pre></div>\n<p>On your <strong><em>.env</em></strong> file you should provide your email information such as:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&#39;MAIL_SERVER&#39; = &#39;smtp.gmail.com&#39; \n&#39;MAIL_PORT&#39; = 465 \n&#39;MAIL_USE_SSL&#39; = True \n&#39;MAIL_USERNAME&#39; = &quot;username@gmail.com&quot; \n&#39;MAIL_PASSWORD&#39; = &quot;password&quot; </code></pre></div>\n<h3>Configuration of mail</h3>\n<p>After setup all your mail information we need to configurate our mail on Flask app like following:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># configuration of mail</span>\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'MAIL_SERVER'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> MAIL_SERVER\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'MAIL_PORT'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> MAIL_PORT\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'MAIL_USERNAME'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> MAIL_USERNAME\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'MAIL_PASSWORD'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> MAIL_PASSWORD\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'MAIL_DEFAULT_SENDER'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>APP_NAME<span class=\"token punctuation\">,</span> MAIL_USERNAME<span class=\"token punctuation\">)</span>\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'MAIL_USE_TLS'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'MAIL_USE_SSL'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span></code></pre></div>\n<p>And then initialize our mail extension:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#Initialize Mail extension</span>\nmail <span class=\"token operator\">=</span> Mail<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nmail<span class=\"token punctuation\">.</span>init_app<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>User Model Change</h2>\n<p>A small change is necessary to be done in our user Model table of our flask-praetorian block on Flask app, we need to add the attribute table <strong>email</strong> and setup the <strong>is_active</strong> attribute to be false by default, like following:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'users'</span>\n\n    <span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>Column<span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    username <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>Column<span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">,</span> unique<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    email <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>Column<span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">,</span> unique<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    password <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>Column<span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    roles <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>Column<span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">)</span>\n    is_active <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>Column<span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">.</span>Boolean<span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> server_default<span class=\"token operator\">=</span><span class=\"token string\">'true'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token decorator annotation punctuation\">@property</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">rolenames</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>roles<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">except</span> Exception<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token decorator annotation punctuation\">@classmethod</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">lookup</span><span class=\"token punctuation\">(</span>cls<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> cls<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>one_or_none<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token decorator annotation punctuation\">@classmethod</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">lookup</span><span class=\"token punctuation\">(</span>cls<span class=\"token punctuation\">,</span> email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> cls<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>email<span class=\"token operator\">=</span>email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>one_or_none<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token decorator annotation punctuation\">@classmethod</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">identify</span><span class=\"token punctuation\">(</span>cls<span class=\"token punctuation\">,</span> <span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> cls<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token decorator annotation punctuation\">@property</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">identity</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">is_valid</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>is_active</code></pre></div>\n<p>This will ensure that the application can only be used when the <strong>is_active</strong> attribute is true, which will only happen when the user confirms receipt of the email through the access token that we will send shortly.</p>\n<p><strong>DO NOT FORGET TO CHANGE (ALTER TABLE) YOUR SQL TABLE ON DATABASE, ADDING <em>email</em> ATTRIBUTE AND CHANGING <em>is_active</em> ATTRIBUTE!!</strong></p>\n<p>Done that we can focus on our new endpoints we are going to create and change our old ones.</p>\n<h2>Registration endpoint</h2>\n<p>As we will use the method <code class=\"language-text\">send_registration_email</code> from flask-praetorian, on our registration endpoint we need to load the CONFIRMATION_URI which will points to a frontend confirmation uri address with the token sent to the email. In my case it is <strong><em>CONFIRMATIONURI = ’<a href=\"https://patriciadourado.com/jwtlogin-reactjs/#/finalize\">https://patriciadourado.com/jwtlogin-reactjs/#/finalize</a>’</em></strong> with the subject mail as following: <strong><em>SUBJECT = ‘Please confirm your registration’</em></strong>;</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">subject <span class=\"token operator\">=</span> SUBJECT\nconfirmation_sender<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>APP_NAME<span class=\"token punctuation\">,</span> MAIL_USERNAME<span class=\"token punctuation\">)</span>\nconfirmation_uri <span class=\"token operator\">=</span> CONFIRMATION_URI</code></pre></div>\n<p>Its also necessary to load from frontend POST Method the user information such as <strong>username</strong>,<strong>password</strong> and <strong>email</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">req <span class=\"token operator\">=</span> flask<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>get_json<span class=\"token punctuation\">(</span>force<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\nusername <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'username'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\npassword <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\nemail <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'email'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In our endpoint method we will validate if the <strong>username</strong> or <strong>email</strong> already exists in our database, if not, the user is inserted/registered with a <strong><em>201 success message return</em></strong>;</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">    <span class=\"token keyword\">if</span> db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>email<span class=\"token operator\">=</span>email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n            new_user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">(</span>\n                username<span class=\"token operator\">=</span>username<span class=\"token punctuation\">,</span>\n                email<span class=\"token operator\">=</span>email<span class=\"token punctuation\">,</span>\n                password<span class=\"token operator\">=</span>guard<span class=\"token punctuation\">.</span>hash_password<span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                roles<span class=\"token operator\">=</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">)</span>\n            db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>new_user<span class=\"token punctuation\">)</span>\n            db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n            guard<span class=\"token punctuation\">.</span>send_registration_email<span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">,</span> user<span class=\"token operator\">=</span>new_user<span class=\"token punctuation\">,</span> confirmation_sender<span class=\"token operator\">=</span>confirmation_sender<span class=\"token punctuation\">,</span>confirmation_uri<span class=\"token operator\">=</span>confirmation_uri<span class=\"token punctuation\">,</span> subject<span class=\"token operator\">=</span>subject<span class=\"token punctuation\">,</span> override_access_lifespan<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n\n            ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'successfully sent registration email to user {}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>\n                new_user<span class=\"token punctuation\">.</span>username\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>flask<span class=\"token punctuation\">.</span>jsonify<span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">201</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'email {} already exists on DB!'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>flask<span class=\"token punctuation\">.</span>jsonify<span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">303</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'user {} already exists on DB!'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>flask<span class=\"token punctuation\">.</span>jsonify<span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">409</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>You can check below the ReactJS page which points to our Registration endpoint:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 519px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/frompat/static/3a719a812ad145fe9193ede8b1f6a366/b23ad/registration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 141.13924050632912%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAABJ0AAASdAHeZh94AAAC3UlEQVQ4y5VUS08TURSeX2HcGYIhvNzA1p2Ja1euXRghgFARBFa60PBoy6NFbBA1LpSaGCEudKcYdGETFxCgHQZoZ/qQSp8z03am86jfzC2VASrly830Ps53vnPOPbdUyQpd1/HdY5j5gcHc/n5l51RQx9aqquL70fvuJkU9f/ho1fcTS03TaiITu0gkcuPCxfmOzg+fPxXy+Wr61MktjYgvvBhqaFoYGvF6F2VJqkFZ10VR1CBi6gQ2Nr6+XfT9+J5MJk8Vt5A1RXa5Zhx2u9vtdthH5zyeL99WX796OeOanXW5l5eWTQErGS41E6qiHBwcRCMRn8/n9/uj0WgqkQyFgr+BWCybyRIz3YRBJkzlEJXQiIW5oxOCqqiyCWySulJFEyhSTswBooghKqpacV+ZHAVc4FIpkyBK+bzfT4dCLMPs0NtMQZJL/wXP85IkUfhJp9NYC3wZORJBdSBm1B9GBjmVSiEwFCUUNLAfj2ez2Ux1gJxIJCzkQqEgI3tFKZ4FGJfJREQQhK0tfyBAy0WlVAOsypqGCfLJ14B/ypWw0RJ7e0FUIn0WjueMSFD6olyUZYl0grEkMOeFI7DkDGc4DIbYzc1NjgvjttlwmGW5QCCwuxtktnfi8T+k6armDC+YoHKGu0wG+0gBO3AtCKIkGfpoTAR1Ss645zAX5jgOB2gYuDjsGp5EB+uVlRWapqGM92Mh4zhlImPSsicGLwjoH4RzXLl0TlgKhkzGnZMd3Xd7bP1dvbb+oeGB4RFMbIMPeu8PdPfdw8DRna6emadzqqZCH01Bob1w7zTD1De11je3Xm65cqmh8eq167Dr7rXd6ui83dnV2tZe19iCo7rG5pa29mgsZiYhlF8V7v3NovfJ2MSEc2rcMTnmcNqnpmefeZzTLgwssYmjx6Pj75eWLFdFnuS5UH6S6BjysvnagGhRIFTK+DPQzPbAM15bW/tVA9bX11mWhQsQ/wLhLeg9xaHFsgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"registration-page\"\n        title=\"Registration-Page\"\n        src=\"/frompat/static/3a719a812ad145fe9193ede8b1f6a366/b23ad/registration.png\"\n        srcset=\"/frompat/static/3a719a812ad145fe9193ede8b1f6a366/c26ae/registration.png 158w,\n/frompat/static/3a719a812ad145fe9193ede8b1f6a366/6bdcf/registration.png 315w,\n/frompat/static/3a719a812ad145fe9193ede8b1f6a366/b23ad/registration.png 519w\"\n        sizes=\"(max-width: 519px) 100vw, 519px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Finalize endpoint</h2>\n<p>After sending the registration email to the user, the token validation is required, for that we will create an endpoint called <strong><em>finalize</em></strong> where from the frontend GET Method with the token in header token we will get the user, and then activate it in our database.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">registration_token <span class=\"token operator\">=</span> guard<span class=\"token punctuation\">.</span>read_token_from_header<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nuser <span class=\"token operator\">=</span> guard<span class=\"token punctuation\">.</span>get_user_from_registration_token<span class=\"token punctuation\">(</span>registration_token<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># user activation</span>\nuser<span class=\"token punctuation\">.</span>is_active <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\ndb<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Returning a <strong><em>200 success code</em></strong> to the frontend along with the JWT token and username:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'access_token'</span><span class=\"token punctuation\">:</span> guard<span class=\"token punctuation\">.</span>encode_jwt_token<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'user'</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>flask<span class=\"token punctuation\">.</span>jsonify<span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Reset Password endpoint</h2>\n<p>The reset password endpoint will use a different subject email to specify the user that a reset request has been made.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/reset'</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token triple-quoted-string string\">\"\"\"Reset password email\"\"\"</span>\n\n    reset_sender<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>APP_NAME<span class=\"token punctuation\">,</span> MAIL_USERNAME<span class=\"token punctuation\">)</span>\n    reset_uri <span class=\"token operator\">=</span> RESET_URI\n    subject_rest <span class=\"token operator\">=</span> SUBJECT_RESET</code></pre></div>\n<p>The ReactJS page with its validations for email, used in this application can be seen below:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 593px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/frompat/static/70cb0a578c0e10e8c35ba870e111a45c/0b5b1/resetpw.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 96.83544303797468%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAABJ0AAASdAHeZh94AAACR0lEQVQ4y51SbWvTUBTurxD8I+KPceKm+ML84sr0w9yUSRFEEHzBz36x3fbBDgQH2dAiFtYytkFdu7RbU5ukWZvk5t7c3KRpk3husq1Ttjk8PFzOPTnPPc85J6nobAvDcDgcnpOQOp0WRV8XFrVdMXniouQklbjutUuXX4/fLFUqURBciBwEAegcDgbgz49PzFy5upzPmwjBFcJBbP+QnRTvatr7W7c/PEivCcKFKpfL5VJpfWtzs7Reajab5Y2Nz/m8IAi1Wm1n52e1Vq1UKp7nnUoOi8Xi0tJiLvsxm1vY3tr+8b2QzeU+5ZdXBWFl5YuwtvqtUHAYO1aXOrGV4Oy5jixpflQZmL7vw6zs2BhjNDbbBtgYE/BBrc9tkCQn++dkuMQcp7G3J7dlSZIONK0ltfabUqsliY0GxOHrsVpITjrnZPAMwwAxDpQghFgWtanHXNdlLmOe68HJHAcABmkIIRZ3PiLDehVVbSnyL0VWOh1EMLIJBzgY85Ng00J+v/83Wdd1EDRgrm9aA4QBfd3wD3S/q/s9A4IcBvIpF28axgmy6xrYCnsGTWfo3Vk6+YTem2WPXrBnb9n8GzbzEq50co6f95+G+22T2ix+5YhMcKD1yJ3HZCxNbkyTsSl7KuNk3tG5V3T6ObkeB+GceBiITeRQ2MchuR+3wRfH3AjhyCIcOoq6etQzuZNE4BPlajHGMMxDMgyQ2LaiKLt1sSoeAfx6PcYoWBNFud0G8mjPyaoty9JUVZXlc6CpHWSakPzH7/l/9hu8yRj2M99d8gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"send-reset-email\"\n        title=\"Send-Reset-Email\"\n        src=\"/frompat/static/70cb0a578c0e10e8c35ba870e111a45c/0b5b1/resetpw.png\"\n        srcset=\"/frompat/static/70cb0a578c0e10e8c35ba870e111a45c/c26ae/resetpw.png 158w,\n/frompat/static/70cb0a578c0e10e8c35ba870e111a45c/6bdcf/resetpw.png 315w,\n/frompat/static/70cb0a578c0e10e8c35ba870e111a45c/0b5b1/resetpw.png 593w\"\n        sizes=\"(max-width: 593px) 100vw, 593px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>A success message is displayed on the frontend application to show that the email was sent to a valid address.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/be1b7/reset-email.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABJ0AAASdAHeZh94AAAA7klEQVQY04WQy26DMBBF/Y35gS7TNFm2H5BIrRIluDxq5BhHYol4ZAlLXkLiY9g3BQG9AkWCbHIX4zujOfaMycfy9ft0sqQ8c34ehMMSQtHZYrN7ef+6l2d6W6+XqxXZb3fHw2EGc26apvHDPo/qXtHMQXx+B6VUoZTIy+WBtG3b8zzXda+Bf/V9GKQoTnkpLYjwQWNJCGEYRpIkfd83TfPX3G71b13XSLMs03UdwPR9Mk1GOE1TdHddhwDTti1inueapj2H4zgOwxDjyGE4xKqqyrJUVfUJjL/BklEUjWs7jgNTFEUQBIwxNEz7/wFeDQyZyvjh1gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"success-message\"\n        title=\"Success Message\"\n        src=\"/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/f058b/reset-email.png\"\n        srcset=\"/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/c26ae/reset-email.png 158w,\n/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/6bdcf/reset-email.png 315w,\n/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/f058b/reset-email.png 630w,\n/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/40601/reset-email.png 945w,\n/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/78612/reset-email.png 1260w,\n/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/be1b7/reset-email.png 1887w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>On the Flask app you will need to specify a <strong><em>SUBJECT</em>RESET_</strong> to your email and a <strong><em>reset</em>uri_</strong> pointing to your frontend page to define a new user password. For example, this page uri was used in our app to redefine the user’s password:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 535px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/frompat/static/62156603d89007f9876c0cc9dc24d83c/b5245/reset-password.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 124.0506329113924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAABJ0AAASdAHeZh94AAADCElEQVQ4y6VUS28SURS+2IUx/gk1prEaF9WFadGFC41VN2514W/QmBgTly61r2hLEzWpxtJa0gaIRm1c6KKLtiSEUB4DhaFQHsNjyryZF34wBQExNvHkcjj3zPnud865Z4bU/0NIX69Zr//weDmm2LBN87BgwzCgYzuJe0ePLz14GM9kDF0/LNjikSTp7tC5p9dvvF34UK1W/8ZPepCaptVqNdhfXa5HJ0/PP36yuLQk8oJu6HjUkwXpgraPN01V1wM+3zeHY83rrXJcX3LS9sqS9OXT5zmHY8HpXF9f93jc8+/eO12uldVVt9sDfmin01koFNqQ38yaqhXy+UAgEI5EcrmsqqkxivJtbcETjUSoaDQWi8diMVEUu5jRYa0phnGQmNEsvidPE49Rjqo2Ixs2wU9RFGxkWYaBgwVBgCFLqEM2OgSRlsZBaKqu6wS//f19aAqZRal0Ju33I0/YUau8vsJxHPAEOTAMgyPBybJstSXgx20LHYKAfD5fLpdBDo2nDTAYAMY+SdPpdJqmk9DYsmyF7RCe5zc2NiiKAnOpVOoC/zGnZuvKG8oaHoShQDB3gaGRKgx4K5UKU2Sg9zJ7xWKx3BQEdM5JB5hhoDOZTDKZzOVQVz6RSAAW34Ek4KRTKdyF2ZI+aUuSCBcw6F+pVC41BXXiwkRR4nkOPQuFQqlUqheMSth9NpvNghbjlbf+slkE4SLRLWiB58PhMJ2izb4NM0xDN9EQNMtQ9JqiK7ImS6qk4Y1qrt6aMcOgwf6Zf/zE4vBZl31oeXTw46Ur3tt2z81Rz9hl760zyyNYQ67RU4sX76zdFzSJLVdESSSYVQZpG4Z95Sp5TgamB2xTNjJBBp0XhlevjbjHzrvsZNpmmyIE/klyZOZYnKMFlhdEwep2Ywwj1fhUaO5l+LW1Jrcdk9tzL4Iz48FZy/Mq/GYiOPs9+xPBBxNmzTaOUXilLpodC1+j1upwaoKKOcVQNGYbx+AdyuVywe3gpm/zn8sf8O/u7gKPHpP2p6vxGh5O0Cbrdn4BLjZAjXmuJvQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"reset-password\"\n        title=\"Reset-Password\"\n        src=\"/frompat/static/62156603d89007f9876c0cc9dc24d83c/b5245/reset-password.png\"\n        srcset=\"/frompat/static/62156603d89007f9876c0cc9dc24d83c/c26ae/reset-password.png 158w,\n/frompat/static/62156603d89007f9876c0cc9dc24d83c/6bdcf/reset-password.png 315w,\n/frompat/static/62156603d89007f9876c0cc9dc24d83c/b5245/reset-password.png 535w\"\n        sizes=\"(max-width: 535px) 100vw, 535px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>With the email from frontend request:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">req <span class=\"token operator\">=</span> flask<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>get_json<span class=\"token punctuation\">(</span>force<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\nemail <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'email'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>We will check if the email exists on our database and if the <strong><em>is</em>active_</strong> table attribute is True (which means the user already activated its account app). If the email exists and the user was activated a reset email is sent to the user through <strong><em>send</em>reset<em>email</em></strong> method from flask-praetorian;</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">if</span> db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>email<span class=\"token operator\">=</span>email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span>email<span class=\"token operator\">==</span>email<span class=\"token punctuation\">,</span> User<span class=\"token punctuation\">.</span>is_active<span class=\"token operator\">==</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>scalar<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            guard<span class=\"token punctuation\">.</span>send_reset_email<span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">,</span> reset_sender<span class=\"token operator\">=</span>reset_sender<span class=\"token punctuation\">,</span> reset_uri<span class=\"token operator\">=</span>reset_uri<span class=\"token punctuation\">,</span> subject<span class=\"token operator\">=</span>subject_rest<span class=\"token punctuation\">,</span> override_access_lifespan<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n\n            ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'successfully sent password reset email to {}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>flask<span class=\"token punctuation\">.</span>jsonify<span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'{} account not activated! active it first!'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>flask<span class=\"token punctuation\">.</span>jsonify<span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">403</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'email {} doest not exists on DB!'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>flask<span class=\"token punctuation\">.</span>jsonify<span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">404</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The <strong><em>code message 200</em></strong> is sent to the frontend if everything goes fine, a <strong><em>403 code error message</em></strong> is sent if the user is not activated and a <strong><em>404 code message</em></strong> is sent if the user’s email doesn’t exists on our database;</p>\n<h2>Finalize Reset Password endpoint</h2>\n<p>The reset password finalize endpoint will validate the token from the POST Method header and if everything goes fine it will hash a new password to the user, storing it in the database.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/reset_finalize'</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">reset_finalize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token triple-quoted-string string\">\"\"\"Reset password on database by token\"\"\"</span>\n\n\n    req <span class=\"token operator\">=</span> flask<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>get_json<span class=\"token punctuation\">(</span>force<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    password <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n\n    reset_token <span class=\"token operator\">=</span> guard<span class=\"token punctuation\">.</span>read_token_from_header<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        user <span class=\"token operator\">=</span> guard<span class=\"token punctuation\">.</span>validate_reset_token<span class=\"token punctuation\">(</span>reset_token<span class=\"token punctuation\">)</span>\n        user<span class=\"token punctuation\">.</span>password <span class=\"token operator\">=</span> guard<span class=\"token punctuation\">.</span>hash_password<span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span>\n        db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'access_token'</span><span class=\"token punctuation\">:</span> guard<span class=\"token punctuation\">.</span>encode_jwt_token<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'user'</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>flask<span class=\"token punctuation\">.</span>jsonify<span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> Exception<span class=\"token punctuation\">:</span>\n        ret <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Error resetting user password by token:\"</span><span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> ret<span class=\"token punctuation\">,</span> <span class=\"token number\">500</span></code></pre></div>\n<p>A <strong><em>200 code message</em></strong> is returned to the frontend if the password has been reset and a <strong><em>500 code</em></strong> is sent if Error.</p>\n<p>The Reset Password Finalize endpoint will point to our frontend application a page where the user is redirected if the password has been successfully reset, the page can be a protected page to the application or the login page, its your choice! :)</p>\n<h2>My Code Application Available</h2>\n<p>To have access to all the code for this Flask application you can visit my repository on github which also contains the address for the online application, clicking here: <a href=\"https://github.com/patriciadourado/jwtlogin-flask\">jwtlogin-flask</a>.</p>\n<p>You can also check the ReactJS application developed to consume all these endpoints with the Registration, Login and Reset Password pages and validations for email and password on frontend, clicking here: <a href=\"https://github.com/patriciadourado/jwtlogin-reactjs\">jwtlogin-reactjs</a>.</p>\n<h2>Thank you</h2>\n<p>Hope you enjoyed! </p>\n<p>More features are coming soon. :)</p>","fields":{"slug":"/jwt-app-with-email-token-registration-and-reset-password/"},"frontmatter":{"title":"JWT App - Email Token Registration and Reset Password","date":"September 29, 2021","description":"As mentioned in JWT Login Flask post, more features have been added to Flask endpoint and ReactJS application, such as token registration via email and password reset.","featuredImage":{"childImageSharp":{"fixed":{"src":"/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/455ef/reset-email.png"},"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAABJ0AAASdAHeZh94AAABq0lEQVQoz42TvU7CUBTHeQ0fw2dwkAmEDj6As3FDF6MRB4mK0A/opyCEEJoQGGBhYSOEjcAAhISwkUCApFJLaYuHlmJLCfGX5uSe0/u//3tub12UHZKiGJp+ixKBYPjuORwIvoc+MIbe1J249vI4SaYTLHL9dHJ+c3p5C/Hs6j7BMST5DzFA01QUjz2GosFX9OElEkZjUKGOO9MWWIZJcOwnx0JkWYa2c0Acs0OYj5N9Maz35SCVSjmLyWRyZ+6CEUEQ+XxeFMUfOwtxYS3BBFmWx+Mx6OPx+FaM43ixWFzvo2lrdbVeWnINoiAI4P8nBudCoWC8U7doK0WeSxNhOVfUlVlUDfEBZ0XHWMLwUTRZ1ZSd587ZJjac4QWIoTFJkhbA96ZlIzV6nk6nB8QoilYqlWq16vf7EQTxer0ejwfGEC90fD6f2+3meX44HE4mE1vPGIaVy+XRaFSr1RqNRjabzWQypVKJN8nlcjBhNptZDwyEm+8Mo3Q63W63B4NBv9/v6PR6vW632zGBtNVqNZvNer3OcRyp3/XtJYEENh85CkyAPcLpkuZf8gvMEXFCdWEzgQAAAABJRU5ErkJggg==","aspectRatio":1.3333333333333333,"src":"/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/9119a/reset-email.png","srcSet":"/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/4271c/reset-email.png 500w,\n/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/b03e4/reset-email.png 1000w,\n/frompat/static/3b8b819ca2c0a5c290e00090e88a2e9f/9119a/reset-email.png 1887w","sizes":"(max-width: 1887px) 100vw, 1887px"}}}}},"previous":{"fields":{"slug":"/developing-a-twitter-bot-with-python/"},"frontmatter":{"title":"Developing a Twitter bot with Python"}},"next":null},"pageContext":{"id":"af3dc10a-d2c7-5158-b116-fe131ade96be","previousPostId":"75821f1f-2ce4-5110-9a26-8ccd42fd34d5","nextPostId":null}},"staticQueryHashes":["3991963069","916993862"]}